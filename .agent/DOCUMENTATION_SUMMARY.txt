================================================================================
CEDRO DOCUMENTATION - SUMMARY & QUICK STARTt
================================================================================

Created: November 2025
Location: .agent/ folder
Purpose: Centralized documentation hub for all engineers

================================================================================
DOCUMENTATION FILES CREATED
================================================================================

ðŸ“„ README.md
   â†’ START HERE: Central index for all documentation
   â†’ Navigation hub with quick links
   â†’ Recent updates overview
   â†’ Key technologies and contacts

ðŸ“„ 01-project-architecture.md
   â†’ Complete system overview and architecture
   â†’ Tech stack breakdown
   â†’ Directory structure with file organization
   â†’ Key architectural patterns (React Query, Supabase, Audio Processing)
   â†’ Data flow diagrams
   â†’ Integration points with external services
   â†’ Database schema overview

ðŸ“„ 02-database-schema.md
   â†’ Complete Supabase database schema reference
   â†’ All 30+ tables with fields and constraints
   â†’ Primary keys, foreign keys, relationships
   â†’ Status enums and valid values
   â†’ Query patterns and examples
   â†’ Performance considerations

ðŸ“„ 03-design-system.md
   â†’ MotherDuck Design System implementation guide
   â†’ Color palette (Dark, Teal, Beige, Blue)
   â†’ Typography scales and usage
   â†’ Spacing system (8px-40px)
   â†’ Component styles (buttons, cards, forms, badges)
   â†’ Tailwind CSS classes for all styles
   â†’ Decorative elements (Cloud, Diamond, Cube icons)
   â†’ Accessibility guidelines

ðŸ“„ 04-sop.md
   â†’ Standard Operating Procedures for development
   â†’ Step-by-step guides for:
     * Adding a new feature (5 steps)
     * Database migrations
     * Creating React components
     * Implementing data fetching
     * Testing (unit, component, integration)
   â†’ Code review checklist
   â†’ Useful development commands

ðŸ“„ 05-recent-updates.md
   â†’ November 2025 updates and improvements
   â†’ MotherDuck Design System implementation details
   â†’ Dashboard improvements breakdown
   â†’ Agenda feature current status
   â†’ n8n workflow integration
   â†’ Roadmap for future features
   â†’ Quality assurance process

================================================================================
RECENT IMPROVEMENTS (NOVEMBER 2025)
================================================================================

âœ… KPI METRICS VALIDATION VIA SUPABASE MCP (Latest)
   - Detected critical data mismatch: Stats cards showed 0 patients vs 78 in BD
   - Root Cause: Function queried non-existent columns in database view
   - Solution: Rewrote getPatientStats() to use cedro.patients table directly
   - Validated all key metrics via Supabase MCP:
     * Total Patients: 78 âœ“
     * Patient Status Distribution: 0 suspended, 0 active, 78 inactive
     * Appointments Today: 22 âœ“
     * Revenue (Month): R$ 0,00 âœ“
     * Overdue Invoices: 0 âœ“
   - Impact: Dashboard and Pacientes page now show accurate BD-sourced metrics
   - Files Updated: src/data/pacientes.ts

âœ… MOTHERDUCK DESIGN SYSTEM APPLIED
   - Color palette: Dark (#383838), Teal (#16AA98), Beige (#F4EFEA), Blue (#6FC2FF)
   - Typography: Space Mono (headings), Inter (body)
   - Spacing system: 8px-40px values
   - All UI components updated with consistent styling
   - Design system showcase at /design-system route

âœ… DASHBOARD IMPROVEMENTS
   - KPI cards with visual metrics
   - Advanced charts (Revenue, Therapist, CRM Funnel, Payments)
   - Period selector for time filtering
   - Widgets: Paused Patients, Overdue Invoices, Recent Leads
   - Real-time data integration

ðŸš§ AGENDA FEATURE (IN DEVELOPMENT)
   - Appointment modal component created
   - Therapist schedule management
   - Schedule exceptions (blocks/extra times)
   - Status tracking (scheduled, confirmed, completed, cancelled, no_show, rescheduled)
   - Planned: Calendar view, confirmations, video integration

ðŸ”§ SUPABASE MCP INTEGRATION
   - Using Supabase MCP for type generation
   - Ensuring data consistency
   - Validating migrations before deployment
   - Monitoring database health

================================================================================
HOW TO USE THIS DOCUMENTATION
================================================================================

FIRST TIME HERE?
1. Read README.md for overview
2. Review 01-project-architecture.md for system design
3. Check 03-design-system.md for UI standards

ADDING A NEW FEATURE?
1. Follow 04-sop.md step-by-step
2. Reference 02-database-schema.md for table info
3. Apply 03-design-system.md for UI consistency

UNDERSTANDING DATABASE?
1. Start with 01-project-architecture.md (overview)
2. Deep dive into 02-database-schema.md (detailed reference)

STYLING & DESIGN?
1. Read 03-design-system.md completely
2. Check /design-system route for live examples
3. Reference Tailwind CSS classes in design doc

RECENT CHANGES?
1. See 05-recent-updates.md for latest work
2. Understand MotherDuck system from 03-design-system.md
3. Check SOP for implementation patterns

================================================================================
KEY TECHNOLOGIES
================================================================================

Frontend:  Next.js 14, React 18, TypeScript, Tailwind CSS, Radix UI
Backend:   Supabase (PostgreSQL), Next.js API Routes
Data:      TanStack Query (React Query), Zod validation
Testing:   Vitest, React Testing Library
Audio:     FFmpeg (server-side), Whisper API, Groq/OpenAI
Storage:   MinIO (S3-compatible)
Automation: n8n with agent workflows
Payments:  Asaas payment gateway

================================================================================
DEVELOPMENT STANDARDS
================================================================================

âœ… MUST DO:
   - Use cedro schema in database queries (NOT public)
   - Create pure API functions in src/lib/api/
   - Wrap data with React Query hooks
   - Use queryKeys factory from react-query-patterns.ts
   - Apply MotherDuck design system to all UI
   - Handle errors with proper toast notifications
   - Write TypeScript with strict mode
   - Test critical functions

âŒ MUST NOT DO:
   - Hardcode schema names or values
   - Query database directly from components
   - Use inline styles (use Tailwind classes)
   - Skip error handling
   - Create components without design system compliance
   - Commit to main without tests
   - Use console.log in production code

================================================================================
QUICK REFERENCE
================================================================================

DATABASE QUERY TEMPLATE:
  const { data } = await supabase
    .schema('cedro')                    // Always use cedro schema
    .from('table_name')
    .select('*')
    .eq('id', value);

REACT QUERY HOOK TEMPLATE:
  export function useFeature(id: string | undefined) {
    return useQuery({
      queryKey: queryKeys.features.detail(id),
      queryFn: () => getFeatureById(id!),
      enabled: !!id,
      ...QUERY_OPTIONS_DETAIL
    });
  }

MOTHERDUCK STYLING:
  <div className="text-motherduck-dark bg-motherduck-beige border-2 border-motherduck-dark p-spacing-m">
    <h1 className="font-mono text-heading-1 font-bold uppercase">Title</h1>
    <p className="text-body-lg">Body text</p>
  </div>

BUTTON VARIANTS:
  <Button variant="teal">Primary</Button>
  <Button variant="outline">Secondary</Button>
  <Button variant="ghost">Tertiary</Button>

================================================================================
GETTING HELP
================================================================================

Need to understand...
  â†’ System architecture? â†’ Read 01-project-architecture.md
  â†’ Database tables? â†’ Read 02-database-schema.md
  â†’ UI/Design standards? â†’ Read 03-design-system.md
  â†’ How to add features? â†’ Read 04-sop.md
  â†’ Recent changes? â†’ Read 05-recent-updates.md

Found an issue?
  â†’ Check existing documentation for context
  â†’ Review code examples in relevant doc
  â†’ Search /design-system route for UI patterns
  â†’ Check vitest tests for implementation patterns

================================================================================
NEXT STEPS (ROADMAP)
================================================================================

IMMEDIATE (1-2 weeks):
  â–¡ Complete agenda calendar view
  â–¡ Appointment confirmation workflow
  â–¡ Mobile responsive improvements
  â–¡ Medical records SOAP templates

SHORT-TERM (1-2 months):
  â–¡ Patient portal (patient-facing web)
  â–¡ Video consultation integration
  â–¡ Automated report generation
  â–¡ Advanced analytics dashboards

MEDIUM-TERM (2-4 months):
  â–¡ Mobile app (React Native)
  â–¡ Prescription management
  â–¡ Insurance integration
  â–¡ Document upload & management

See 05-recent-updates.md for complete roadmap.

================================================================================
DEBUGGING & MCP VALIDATION WORKFLOW
================================================================================

When debugging KPI/metrics mismatch between UI and database:

STEP 1: Use Supabase MCP to validate database state
  mcp_supabase_execute_sql:
  - Check row counts: select count(*) from cedro.patients;
  - Validate status distribution using derived logic
  - Check appointment counts, revenue, overdue invoices
  - Verify schema is "cedro" not "public"

STEP 2: Use Playwright MCP to extract UI values
  mcp_Playwright_browser_navigate: Go to page (e.g., /pacientes)
  mcp_Playwright_browser_evaluate: Extract text/numbers from DOM
  mcp_Playwright_browser_take_screenshot: Capture visual state
  mcp_Playwright_browser_console_messages: Check for JS errors

STEP 3: Compare values
  UI value â‰  DB value? Check:
  - Query uses schema('cedro')? (Not 'public')
  - View/table has the columns code expects?
  - Status derivation logic matches (active/inactive/suspended)?
  - Join relationships valid (e.g., FK exists)?

STEP 4: Fix and re-validate
  - Update API functions, test locally
  - Re-run Playwright to extract new UI values
  - Re-run Supabase MCP SQL to confirm DB state
  - Document fix in RECENT UPDATES section

Recent Fix Example:
  Issue: /pacientes showed 0 patients vs 78 in database
  Root Cause: getPatientStats() queried vw_patient_overview but expected
             columns (is_on_hold, last_appointment) didn't exist in view
  Fix: Query cedro.patients directly, aggregate appointments for status
  Result: UI now shows accurate 78 patients

================================================================================
TIPS & BEST PRACTICES
================================================================================

1. Always read the relevant .agent docs before starting work
2. Use the SOP as a checklist for new features
3. Check design-system page (/design-system) for live component examples
4. Reference database schema when querying data
5. Keep architecture patterns consistent across codebase
6. Write comments for complex logic
7. Test your changes before committing
8. Update docs if you change architecture patterns
9. Use TypeScript strict mode - no `any` without comments
10. Toast notifications for user feedback on all mutations
11. Use Supabase MCP + Playwright MCP to validate metrics/UI consistency

================================================================================
DOCUMENT METADATA
================================================================================

Created:  November 2025
Status:   Active
Location: .agent/ directory (5 files + this summary)
Authors:  Development team with Claude Code
Purpose:  Comprehensive system documentation for developers
Audience: Engineers, designers, architects
License:  Internal use only

All files are markdown (.md) format except this summary (.txt).
Last updated: November 2025

================================================================================
